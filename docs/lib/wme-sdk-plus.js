var initWmeSdkPlus=function(){"use strict";var C=Object.defineProperty,K=(e,t,i)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,I=(e,t,i)=>K(e,typeof t!="symbol"?t+"":t,i);let U=class{constructor(t){I(this,"_recognizableHooks",new Map),I(this,"_hookDependencies",new Map),I(this,"_installedHooks",new Map);for(const[i,{hook:n,deps:s}]of Object.entries(t))this._recognizableHooks.set(i,n),s&&this._hookDependencies.set(i,s||[])}isHookInstalled(t,i){const n=this._recognizableHooks.get(i);if(!n||!this._installedHooks.has(t))return!1;const s=this._installedHooks.get(t);return s?s.some(r=>r===n):!1}markHookAsInstalled(t,i){var n;const s=this._recognizableHooks.get(i);if(!s)throw new Error(`Hook ${i} not found`);this._installedHooks.has(t)||this._installedHooks.set(t,[]),(n=this._installedHooks.get(t))==null||n.push(s)}async installHook(t,i){const n=this._recognizableHooks.get(t);if(!n)throw new Error(`Hook ${t} not found`);if(this.isHookInstalled(i,t))return;const s=this._hookDependencies.get(t)||[];for(const r of s)await this.installHook(r,i);await Promise.all(n.map(r=>r.install(i))),this.markHookAsInstalled(i,t)}async installAllHooks(t){for(const i of this._recognizableHooks.keys())await this.installHook(i,t)}};var Z=Object.defineProperty,G=(e,t,i)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,h=(e,t,i)=>G(e,typeof t!="symbol"?t+"":t,i),J=Object.defineProperty,B=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,m=(e,t,i)=>B(e,typeof t!="symbol"?t+"":t,i),Q=Object.defineProperty,X=(e,t,i)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,u=(e,t,i)=>X(e,typeof t!="symbol"?t+"":t,i);let Y=class{constructor(t,i){u(this,"_target"),u(this,"_key"),u(this,"_oldValue"),u(this,"_wasDefined",!1),u(this,"_isSwapped",!1),this._target=t,this._key=i,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const tt={onlyIfNotExists:!0,isFactory:!1};let y=class{constructor(t,i,n={}){if(m(this,"_installedInstances",new Map),m(this,"_path"),m(this,"_targetValue"),m(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=i,this._options={...tt,...n}}_getTargetObject(t){let i=t;for(const n of this._path.slice(0,this._path.length-1))i[n]||(i[n]={}),i=i[n];return i}_createSwapper(t){const i=this._getTargetObject(t);return new Y(i,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const i=this._createSwapper(t);if(!(i.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const n=this._targetValue({nativeSdkInstance:t});i.swap(n)}else i.swap(this._targetValue);this._installedInstances.set(t,i)}}uninstall(t){const i=this._installedInstances.get(t);i&&(i.restore(),this._installedInstances.delete(t))}};function z(){return"unsafeWindow"in window?window.unsafeWindow:window}var et=Object.defineProperty,it=(e,t,i)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t,i)=>it(e,typeof t!="symbol"?t+"":t,i);let nt=class{constructor(t,i){a(this,"_target"),a(this,"_key"),a(this,"_oldValue"),a(this,"_wasDefined",!1),a(this,"_isSwapped",!1),this._target=t,this._key=i,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},O=class{constructor(t,i,n){a(this,"_enabled",!1),a(this,"_fnSwapper"),a(this,"_interceptionFunction"),a(this,"_middlewares",[]),this._fnSwapper=new nt(t,i),this._interceptionFunction=n}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const i=this.runMiddlewares(t);if(i){if("output"in i)return i.output;"input"in i&&(t=i.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const i of this._middlewares){const n=i(...t);if(n){if("output"in n)return n;"input"in n&&(t=n.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}};function st(e,t){try{return e()}catch{return t}}let rt=class extends O{constructor(t,i,n){super(t,i,n),a(this,"_loggedInvocationRequests",[]),this.registerMiddleware((...s)=>this.logRequest(...s))}logRequest(...t){this._loggedInvocationRequests.push(t)}flushLoggedRequests(){const t=this.getLoggedRequests();return this._loggedInvocationRequests=[],t}getLoggedRequests(){return this._loggedInvocationRequests}executeOriginalLoggedRequests(){this.flushLoggedRequests().forEach(t=>st(()=>this.callOriginalInvocator(...t)))}},at=class{constructor(){h(this,"_hasResult",!1),h(this,"result")}store(t){return this.result=t,this._hasResult=!0,t}clear(){this.result=void 0,this._hasResult=!1}getResult(){if(this.hasResult)throw new Error("No result is stored");return this.result}get hasResult(){return this._hasResult}};function ot(e){const t=new at;new O(e,"doAction",(i,...n)=>t.hasResult?t.getResult():t.store(i(...n))).enable(),new O(e,"undoAction",(i,...n)=>{const s=i(...n);return t.clear(),s}).enable()}let lt=class{constructor(){h(this,"actions",[]),h(this,"undoableActions",[])}acceptAction(t,i){const n={action:t,dataModel:i};t.undoSupported()&&(ot(t),t.doAction(i),this.undoableActions.push(n)),this.actions.push(n)}undoAll(){this.undoableActions.forEach(({action:t,dataModel:i})=>t.undoAction(i))}getActions(){return this.actions.map(({action:t})=>t)}};function ht(){try{return z().require("Waze/Action/MultiAction")}catch{return null}}function ut(e){const t=ht();if(!t)throw new Error("Unable to retrieve MultiAction");return new t(e)}let ct=class{constructor(t){h(this,"_activeTransaction",null),h(this,"_actionManagerAddInterceptor"),this._actionManagerAddInterceptor=new rt(t,"add",(i,n)=>{var s,r;return(r=(s=this._activeTransaction)==null?void 0:s.acceptAction)==null||r.call(s,n,t.dataModel),!0})}openTransaction(){this._activeTransaction=new lt}closeTransaction(){const t=this._activeTransaction;return this._activeTransaction=null,this._actionManagerAddInterceptor.flushLoggedRequests(),t}get hasTransaction(){return this._activeTransaction!==null}beginTransaction(){this.openTransaction()}commitTransaction(t){if(!this.hasTransaction)throw new Error("No open transaction found");try{const i=this._activeTransaction.getActions(),n=ut(i);t&&(n._description=t),this._actionManagerAddInterceptor.callOriginalInvocator(n)}catch{this._actionManagerAddInterceptor.executeOriginalLoggedRequests()}finally{this.closeTransaction()}}cancelTransaction(){var t;(t=this._activeTransaction)==null||t.undoAll(),this.closeTransaction()}},V;function b(){if(!V){const e=z();V=new ct(e.W.model.actionManager)}return V}const dt=[new y("Editing.beginTransaction",()=>b().beginTransaction()),new y("Editing.commitTransaction",e=>b().commitTransaction(e)),new y("Editing.cancelTransaction",()=>b().cancelTransaction()),new y("Editing.doActions",(e,t)=>{const i=b();i.beginTransaction();try{e(),i.commitTransaction(t)}catch(n){throw i.cancelTransaction(),n}})];var pt=Object.defineProperty,_t=(e,t,i)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,S=(e,t,i)=>_t(e,typeof t!="symbol"?t+"":t,i),ft=Object.defineProperty,wt=(e,t,i)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c=(e,t,i)=>wt(e,typeof t!="symbol"?t+"":t,i);let gt=class{constructor(t,i){c(this,"_target"),c(this,"_key"),c(this,"_oldValue"),c(this,"_wasDefined",!1),c(this,"_isSwapped",!1),this._target=t,this._key=i,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const mt={onlyIfNotExists:!0,isFactory:!1};let D=class{constructor(t,i,n={}){if(S(this,"_installedInstances",new Map),S(this,"_path"),S(this,"_targetValue"),S(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=i,this._options={...mt,...n}}_getTargetObject(t){let i=t;for(const n of this._path.slice(0,this._path.length-1))i[n]||(i[n]={}),i=i[n];return i}_createSwapper(t){const i=this._getTargetObject(t);return new gt(i,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const i=this._createSwapper(t);if(!(i.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const n=this._targetValue({nativeSdkInstance:t});i.swap(n)}else i.swap(this._targetValue);this._installedInstances.set(t,i)}}uninstall(t){const i=this._installedInstances.get(t);i&&(i.restore(),this._installedInstances.delete(t))}};function P(){return"unsafeWindow"in window?window.unsafeWindow:window}var yt=Object.defineProperty,bt=(e,t,i)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,H=(e,t,i)=>bt(e,typeof t!="symbol"?t+"":t,i);function d(){return"unsafeWindow"in window?window.unsafeWindow:window}var St=Object.defineProperty,kt=(e,t,i)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,o=(e,t,i)=>kt(e,typeof t!="symbol"?t+"":t,i);let vt=class{constructor(t,i){o(this,"_target"),o(this,"_key"),o(this,"_oldValue"),o(this,"_wasDefined",!1),o(this,"_isSwapped",!1),this._target=t,this._key=i,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},It=class{constructor(t,i,n){o(this,"_enabled",!1),o(this,"_fnSwapper"),o(this,"_interceptionFunction"),o(this,"_middlewares",[]),this._fnSwapper=new vt(t,i),this._interceptionFunction=n}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const i=this.runMiddlewares(t);if(i){if("output"in i)return i.output;"input"in i&&(t=i.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const i of this._middlewares){const n=i(...t);if(n){if("output"in n)return n;"input"in n&&(t=n.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},Ot=class{constructor(t){H(this,"_fetchInterceptor"),H(this,"_interceptionFilters",new Set),this._fetchInterceptor=new It(t,"fetch",(i,n,s)=>{for(const r of this._interceptionFilters)if(r.shouldIntercept(n,s))return this.shouldKeepFilter(r,n,s)||this.removeInterceptionFilter(r),r.intercept(n,s);return i(n,s)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,i,n){return typeof t.shouldKeep=="function"?t.shouldKeep(i,n):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};function Vt(e){return e=e instanceof URL?e:new URL(e,d().location.href),t=>typeof t=="string"?new URL(t,d().location.href).pathname===e.pathname:t instanceof URL?t.pathname===e.pathname:new URL(t.url,d().location.href).pathname===new URL(e,d().location.href).pathname}function $t(e,t,i){const n=new Response(t,i),s=new URL(e,location.toString());return Object.defineProperty(n,"url",{value:s}),n}function jt(e,t){const i=JSON.stringify(t),n=new Headers({"Content-Type":"application/json"});return $t(e,i,{headers:n})}const Mt=new Ot(d());function Et(e){return P().W.controller.descartesClient.getFeatures([0,0,0,0],{[e]:!0},{})}async function Tt(e,t){const i=P().W.Config.paths.features;Mt.addInterceptionFilter({shouldIntercept:Vt(i),intercept(){return Promise.resolve(jt(i,{[e]:{objects:[t]}}))}});const{[e]:n}=await Et(e),[s]=n.objects;return s.constructor}function Rt(e,t,i={}){const n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties={},n.geometry=e,n}function At(e,t,i={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!W(e[0])||!W(e[1]))throw new Error("coordinates must contain numbers");return Rt({type:"Point",coordinates:e},t,i)}function W(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function p(){return"unsafeWindow"in window?window.unsafeWindow:window}function Ft(e){const t=p().require("Waze/Action/CreateObject");return new t(e)}function zt(e){p().W.model.actionManager.add(Ft(e))}function Dt(e){return e.toISOString().slice(0,16).replace("T"," ")}function Pt(e){return p().W.model.mapComments.getObjectById(e)}function Ht(e,t){const i=p().require("Waze/Action/UpdateObject");return new i(e,t)}function Wt(e,t){p().W.model.actionManager.add(Ht(e,t))}let $;function qt(){if(!$)throw new Error("MapComment not initialized. Make sure to await the enhancedSDK function before using it.")}const Nt=[{async install(){$=await Tt("mapComments",{geometry:At([0,0]).geometry})}},new D("DataModel.MapComments.addMapComment",e=>{qt();const t=new $({geoJSONGeometry:e.geometry,subject:e.subject,body:e.body,lockRank:e.lockRank,endDate:e.endDate?Dt(e.endDate):null});return zt(t),t.getID()}),new D("DataModel.MapComments.updateMapComment",({sdkInstance:e})=>t=>{const i=Pt(t.mapCommentId);if(!i)throw new e.Errors.DataModelNotFoundError("mapComment",t.mapCommentId);const n={};t.geometry&&(n.geoJSONGeometry=t.geometry),t.subject&&(n.subject=t.subject),t.body&&(n.body=t.body),t.lockRank&&(n.lockRank=t.lockRank),Wt(i,n)},{isFactory:!0})];var xt=Object.defineProperty,Lt=(e,t,i)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,k=(e,t,i)=>Lt(e,typeof t!="symbol"?t+"":t,i),Ct=Object.defineProperty,Kt=(e,t,i)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,_=(e,t,i)=>Kt(e,typeof t!="symbol"?t+"":t,i);let Ut=class{constructor(e,t){_(this,"_target"),_(this,"_key"),_(this,"_oldValue"),_(this,"_wasDefined",!1),_(this,"_isSwapped",!1),this._target=e,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(e){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=e,this._isSwapped=!0}};const Zt={onlyIfNotExists:!0,isFactory:!1};class j{constructor(t,i,n={}){if(k(this,"_installedInstances",new Map),k(this,"_path"),k(this,"_targetValue"),k(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=i,this._options={...Zt,...n}}_getTargetObject(t){let i=t;for(const n of this._path.slice(0,this._path.length-1))i[n]||(i[n]={}),i=i[n];return i}_createSwapper(t){const i=this._getTargetObject(t);return new Ut(i,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const i=this._createSwapper(t);if(!(i.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const n=this._targetValue({nativeSdkInstance:t});i.swap(n)}else i.swap(this._targetValue);this._installedInstances.set(t,i)}}uninstall(t){const i=this._installedInstances.get(t);i&&(i.restore(),this._installedInstances.delete(t))}}var Gt=Object.defineProperty,Jt=(e,t,i)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t,i)=>Jt(e,typeof t!="symbol"?t+"":t,i);let q=class{constructor(e,t){f(this,"_target"),f(this,"_key"),f(this,"_oldValue"),f(this,"_wasDefined",!1),f(this,"_isSwapped",!1),this._target=e,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(e){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=e,this._isSwapped=!0}};function M(){return"unsafeWindow"in window?window.unsafeWindow:window}async function Bt(e){const t=[],i=new q(M().W.model.actionManager,"add");i.swap(n=>{t.push(n)});try{await e()}finally{i.restore()}return t}function Qt(e){return e.memoizedProps||{}}function Xt(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&Array.isArray(e.memoizedState)&&e.memoizedState.length===2&&"queue"in e&&e.queue===null&&Array.isArray(e.memoizedState[1])}function Yt(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&typeof e.memoizedState=="object"&&e.memoizedState!==null&&"current"in e.memoizedState&&"queue"in e&&e.queue===null}function te(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&"queue"in e&&typeof e.queue=="object"&&e.queue!==null&&"dispatch"in e.queue&&typeof e.queue.dispatch=="function"}function ee(e){return te(e)?{type:"useState",value:e.memoizedState,dispatch:e.queue.dispatch}:Xt(e)?{type:"useMemo",value:e.memoizedState[0],dependencies:e.memoizedState[1]}:Yt(e)?{type:"useRef",current:e.memoizedState}:null}function ie(e,t){const i=[];let n=e.memoizedState;for(;n;){const s=ee(n);s&&i.push(s),n=n.next}return i}function ne(e,t,i=1/0){let n=e,s=0;for(;n&&s<i;){const r=n.memoizedState?ie(n):[],F=Qt(n),w={fiber:n,hooks:{all:r,useState:r.filter(g=>g.type==="useState"),useMemo:r.filter(g=>g.type==="useMemo"),useRef:r.filter(g=>g.type==="useRef")},props:F};if(t(w))return w;n=n.return,s++}return null}const se="__reactFiber$";function re(e){const t=Object.keys(e).find(n=>n.startsWith(se));if(!t)throw new Error(`No fiber key found for element: ${e}`);const i=e[t];if(!i)throw new Error(`No fiber found for element: ${e}`);return i}const ae=e=>new Promise(t=>{const i=M(),n=new q(i.W.map.olMap,"addControl");n.swap(s=>{e==null||e(s),t(s),n.restore()})});function oe(e){const t=M(),i=t.W.userscripts.toOLGeometry(e);return new t.OpenLayers.Feature.Vector(i)}async function le(e,t){const i=ne(re(e),r=>"onClick"in r.props&&typeof r.props.onClick=="function");if(!i)throw new Error("No fiber found with draw initiator");const{onClick:n}=i.props;//! OpenLayers dependent code below - implementation might change over time
const s=ae(r=>{r.activate=()=>{}});n(new Event("click")),(await s).events.triggerEvent("featureadded",{feature:oe(t)})}var he=Object.defineProperty,ue=(e,t,i)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,N=(e,t,i)=>ue(e,typeof t!="symbol"?t+"":t,i);function ce(){return"unsafeWindow"in window?window.unsafeWindow:window}var de=Object.defineProperty,pe=(e,t,i)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,l=(e,t,i)=>pe(e,typeof t!="symbol"?t+"":t,i);class _e{constructor(t,i){l(this,"_target"),l(this,"_key"),l(this,"_oldValue"),l(this,"_wasDefined",!1),l(this,"_isSwapped",!1),this._target=t,this._key=i,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class fe{constructor(t,i,n){l(this,"_enabled",!1),l(this,"_fnSwapper"),l(this,"_interceptionFunction"),l(this,"_middlewares",[]),this._fnSwapper=new _e(t,i),this._interceptionFunction=n}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const i=this.runMiddlewares(t);if(i){if("output"in i)return i.output;"input"in i&&(t=i.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const i of this._middlewares){const n=i(...t);if(n){if("output"in n)return n;"input"in n&&(t=n.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}class we{constructor(t){N(this,"_fetchInterceptor"),N(this,"_interceptionFilters",new Set),this._fetchInterceptor=new fe(t,"fetch",(i,n,s)=>{for(const r of this._interceptionFilters)if(r.shouldIntercept(n,s))return this.shouldKeepFilter(r,n,s)||this.removeInterceptionFilter(r),r.intercept(n,s);return i(n,s)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,i,n){return typeof t.shouldKeep=="function"?t.shouldKeep(i,n):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}}new we(ce());function ge(e,t,i={}){const n={type:"Feature"};return(i.id===0||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties={},n.geometry=e,n}function me(e,t,i={}){for(const n of e){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<n[n.length-1].length;s++)if(n[n.length-1][s]!==n[0][s])throw new Error("First and last Position are not equivalent.")}return ge({type:"Polygon",coordinates:e},t,i)}function v(){return"unsafeWindow"in window?window.unsafeWindow:window}function ye(e,t,i){const n=new e(i),s=new t(n);return v().W.model.actionManager.add(s),n}function x(e){return v().W.model.permanentHazards.getObjectById(e)}function be(e,t){const i=v().require("Waze/Action/UpdateObject");return new i(e,t)}function Se(e,t){v().W.model.actionManager.add(be(e,t))}function ke(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}let E,T;const ve=[{async install(){const e=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(3) > wz-menu-item:nth-of-type(2)");if(!e||!(e instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await Bt(async()=>{await le(e,me([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_PERMANENT_HAZARD")throw new Error("Unexpected action discovered when tried to resolve AddPermanentHazard action: "+t.actionName);const i=t.object;if(!i)throw new Error("Unexpected state: Added object does not exist");if(i.type!=="permanentHazard")throw new Error("Unexpected state: Expected the added object to be a PermanentHazard instead of "+t.type);E=t.constructor,T=i.constructor}},new j("DataModel.PermanentHazards.addSchoolZone",e=>{if(!T||!E)throw new Error("PermanentHazard or AddPermanentHazard are not initialized. Make sure to await the enhancedSDK function before using it.");return ye(T,E,{type:9,geoJSONGeometry:e.geometry,name:e.name,speedLimit:e.speedLimit,excludedRoadTypes:e.excludedRoadTypes}).getID()}),new j("DataModel.PermanentHazards.updateSchoolZone",({sdkInstance:e})=>t=>{const i=x(t.schoolZoneId);if(!i||i.getAttribute("type")!==9)throw new e.Errors.DataModelNotFoundError("permanentHazard.SchoolZone",t.schoolZoneId);Se(i,ke({geoJSONGeometry:t.geometry,name:t.name,speedLimit:t.speedLimit,excludedRoadTypes:t.excludedRoadTypes}))},{isFactory:!0}),new j("DataModel.PermanentHazards.getSchoolZoneById",()=>e=>{const t=x(e.schoolZoneId);return!t||t.getAttribute("type")!==9?null:t},{isFactory:!0})],Ie={"Editing.Transactions":{hook:dt},"DataModel.MapComments":{hook:Nt},"DataModel.PermanentHazards":{hook:ve}};function R(e){const[t,i,n]=e.split(".").map(Number);return{major:t,minor:i,patch:n}}function A(e,t){return e?t?e.major&&t.major&&e.major!==t.major?e.major-t.major:e.minor&&t.minor&&e.minor!==t.minor?e.minor-t.minor:e.patch&&t.patch&&e.patch!==t.patch?e.patch-t.patch:0:1:-1}function Oe(e,t,i="highest"){let n=null;typeof e.highest=="string"&&(e.highest=R(e.highest)),typeof e.lowest=="string"&&(e.lowest=R(e.lowest));for(const s of t){if(!s.version)continue;if(!n){n=s;continue}if(e.highest&&A(s.version,e.highest)>0||e.lowest&&A(s.version,e.lowest)<0)continue;const r=s.version,F=n.version,w=A(r,F);(i==="highest"&&w>0||i==="lowest"&&w<0)&&(n=s)}if(!n)throw new Error("No matching version found");return n}const Ve={"0.1":e=>{const t=e.constructor;return new t(e.getScriptId(),e.getScriptName())}};function $e(e){const t=Object.entries(Ve).map(([n,s])=>({version:R(n),cloner:s})),{cloner:i}=Oe({highest:e.getSDKVersion()},t);return i(e)}const L=new U(Ie);async function je(e,t={}){if(t.immutable&&(e=$e(e)),e.State.isInitialized()||await e.Events.once({eventName:"wme-initialized"}),t.hooks)for(const i of t.hooks)await L.installHook(i,e);else await L.installAllHooks(e);return e}return je}();
