var initWmeSdkPlus=function(){"use strict";var C=Object.defineProperty,K=(e,t,n)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t,n)=>K(e,typeof t!="symbol"?t+"":t,n);let U=class{constructor(t){I(this,"_recognizableHooks",new Map),I(this,"_hookDependencies",new Map),I(this,"_installedHooks",new Map);for(const[n,{hook:i,deps:s}]of Object.entries(t))this._recognizableHooks.set(n,i),s&&this._hookDependencies.set(n,s||[])}isHookInstalled(t,n){const i=this._recognizableHooks.get(n);if(!i||!this._installedHooks.has(t))return!1;const s=this._installedHooks.get(t);return s?s.some(r=>r===i):!1}markHookAsInstalled(t,n){var i;const s=this._recognizableHooks.get(n);if(!s)throw new Error(`Hook ${n} not found`);this._installedHooks.has(t)||this._installedHooks.set(t,[]),(i=this._installedHooks.get(t))==null||i.push(s)}async installHook(t,n){const i=this._recognizableHooks.get(t);if(!i)throw new Error(`Hook ${t} not found`);if(this.isHookInstalled(n,t))return;const s=this._hookDependencies.get(t)||[];for(const r of s)await this.installHook(r,n);await Promise.all(i.map(r=>r.install(n))),this.markHookAsInstalled(n,t)}async installAllHooks(t){for(const n of this._recognizableHooks.keys())await this.installHook(n,t)}};var Z=Object.defineProperty,G=(e,t,n)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t,n)=>G(e,typeof t!="symbol"?t+"":t,n),J=Object.defineProperty,B=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t,n)=>B(e,typeof t!="symbol"?t+"":t,n),Q=Object.defineProperty,X=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t,n)=>X(e,typeof t!="symbol"?t+"":t,n);let Y=class{constructor(t,n){u(this,"_target"),u(this,"_key"),u(this,"_oldValue"),u(this,"_wasDefined",!1),u(this,"_isSwapped",!1),this._target=t,this._key=n,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const tt={onlyIfNotExists:!0,isFactory:!1};let y=class{constructor(t,n,i={}){if(m(this,"_installedInstances",new Map),m(this,"_path"),m(this,"_targetValue"),m(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=n,this._options={...tt,...i}}_getTargetObject(t){let n=t;for(const i of this._path.slice(0,this._path.length-1))n[i]||(n[i]={}),n=n[i];return n}_createSwapper(t){const n=this._getTargetObject(t);return new Y(n,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const n=this._createSwapper(t);if(!(n.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const i=this._targetValue({nativeSdkInstance:t});n.swap(i)}else n.swap(this._targetValue);this._installedInstances.set(t,n)}}uninstall(t){const n=this._installedInstances.get(t);n&&(n.restore(),this._installedInstances.delete(t))}};function D(){return"unsafeWindow"in window?window.unsafeWindow:window}var et=Object.defineProperty,nt=(e,t,n)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,a=(e,t,n)=>nt(e,typeof t!="symbol"?t+"":t,n);let it=class{constructor(t,n){a(this,"_target"),a(this,"_key"),a(this,"_oldValue"),a(this,"_wasDefined",!1),a(this,"_isSwapped",!1),this._target=t,this._key=n,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},O=class{constructor(t,n,i){a(this,"_enabled",!1),a(this,"_fnSwapper"),a(this,"_interceptionFunction"),a(this,"_middlewares",[]),this._fnSwapper=new it(t,n),this._interceptionFunction=i}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const n=this.runMiddlewares(t);if(n){if("output"in n)return n.output;"input"in n&&(t=n.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const n of this._middlewares){const i=n(...t);if(i){if("output"in i)return i;"input"in i&&(t=i.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}};function st(e,t){try{return e()}catch{return t}}let rt=class extends O{constructor(t,n,i){super(t,n,i),a(this,"_loggedInvocationRequests",[]),this.registerMiddleware((...s)=>this.logRequest(...s))}logRequest(...t){this._loggedInvocationRequests.push(t)}flushLoggedRequests(){const t=this.getLoggedRequests();return this._loggedInvocationRequests=[],t}getLoggedRequests(){return this._loggedInvocationRequests}executeOriginalLoggedRequests(){this.flushLoggedRequests().forEach(t=>st(()=>this.callOriginalInvocator(...t)))}},at=class{constructor(){h(this,"_hasResult",!1),h(this,"result")}store(t){return this.result=t,this._hasResult=!0,t}clear(){this.result=void 0,this._hasResult=!1}getResult(){if(this.hasResult)throw new Error("No result is stored");return this.result}get hasResult(){return this._hasResult}};function ot(e){const t=new at;new O(e,"doAction",(n,...i)=>t.hasResult?t.getResult():t.store(n(...i))).enable(),new O(e,"undoAction",(n,...i)=>{const s=n(...i);return t.clear(),s}).enable()}let lt=class{constructor(){h(this,"actions",[]),h(this,"undoableActions",[])}acceptAction(t,n){const i={action:t,dataModel:n};t.undoSupported()&&(ot(t),t.doAction(n),this.undoableActions.push(i)),this.actions.push(i)}undoAll(){this.undoableActions.forEach(({action:t,dataModel:n})=>t.undoAction(n))}getActions(){return this.actions.map(({action:t})=>t)}};function ht(){try{return D().require("Waze/Action/MultiAction")}catch{return null}}function ut(e){const t=ht();if(!t)throw new Error("Unable to retrieve MultiAction");return new t(e)}let ct=class{constructor(t){h(this,"_activeTransaction",null),h(this,"_actionManagerAddInterceptor"),this._actionManagerAddInterceptor=new rt(t,"add",(n,i)=>{var s,r;return(r=(s=this._activeTransaction)==null?void 0:s.acceptAction)==null||r.call(s,i,t.dataModel),!0})}openTransaction(){this._activeTransaction=new lt}closeTransaction(){const t=this._activeTransaction;return this._activeTransaction=null,this._actionManagerAddInterceptor.flushLoggedRequests(),t}get hasTransaction(){return this._activeTransaction!==null}beginTransaction(){this.openTransaction()}commitTransaction(t){if(!this.hasTransaction)throw new Error("No open transaction found");try{const n=this._activeTransaction.getActions(),i=ut(n);t&&(i._description=t),this._actionManagerAddInterceptor.callOriginalInvocator(i)}catch{this._actionManagerAddInterceptor.executeOriginalLoggedRequests()}finally{this.closeTransaction()}}cancelTransaction(){var t;(t=this._activeTransaction)==null||t.undoAll(),this.closeTransaction()}},V;function b(){if(!V){const e=D();V=new ct(e.W.model.actionManager)}return V}const dt=[new y("Editing.beginTransaction",()=>b().beginTransaction()),new y("Editing.commitTransaction",e=>b().commitTransaction(e)),new y("Editing.cancelTransaction",()=>b().cancelTransaction()),new y("Editing.doActions",(e,t)=>{const n=b();n.beginTransaction();try{e(),n.commitTransaction(t)}catch(i){throw n.cancelTransaction(),i}})];var pt=Object.defineProperty,_t=(e,t,n)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,S=(e,t,n)=>_t(e,typeof t!="symbol"?t+"":t,n),ft=Object.defineProperty,wt=(e,t,n)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,c=(e,t,n)=>wt(e,typeof t!="symbol"?t+"":t,n);let gt=class{constructor(t,n){c(this,"_target"),c(this,"_key"),c(this,"_oldValue"),c(this,"_wasDefined",!1),c(this,"_isSwapped",!1),this._target=t,this._key=n,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const mt={onlyIfNotExists:!0,isFactory:!1};let z=class{constructor(t,n,i={}){if(S(this,"_installedInstances",new Map),S(this,"_path"),S(this,"_targetValue"),S(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=n,this._options={...mt,...i}}_getTargetObject(t){let n=t;for(const i of this._path.slice(0,this._path.length-1))n[i]||(n[i]={}),n=n[i];return n}_createSwapper(t){const n=this._getTargetObject(t);return new gt(n,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const n=this._createSwapper(t);if(!(n.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const i=this._targetValue({nativeSdkInstance:t});n.swap(i)}else n.swap(this._targetValue);this._installedInstances.set(t,n)}}uninstall(t){const n=this._installedInstances.get(t);n&&(n.restore(),this._installedInstances.delete(t))}};function P(){return"unsafeWindow"in window?window.unsafeWindow:window}var yt=Object.defineProperty,bt=(e,t,n)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H=(e,t,n)=>bt(e,typeof t!="symbol"?t+"":t,n);function d(){return"unsafeWindow"in window?window.unsafeWindow:window}var St=Object.defineProperty,kt=(e,t,n)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t,n)=>kt(e,typeof t!="symbol"?t+"":t,n);let vt=class{constructor(t,n){o(this,"_target"),o(this,"_key"),o(this,"_oldValue"),o(this,"_wasDefined",!1),o(this,"_isSwapped",!1),this._target=t,this._key=n,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},It=class{constructor(t,n,i){o(this,"_enabled",!1),o(this,"_fnSwapper"),o(this,"_interceptionFunction"),o(this,"_middlewares",[]),this._fnSwapper=new vt(t,n),this._interceptionFunction=i}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const n=this.runMiddlewares(t);if(n){if("output"in n)return n.output;"input"in n&&(t=n.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const n of this._middlewares){const i=n(...t);if(i){if("output"in i)return i;"input"in i&&(t=i.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},Ot=class{constructor(t){H(this,"_fetchInterceptor"),H(this,"_interceptionFilters",new Set),this._fetchInterceptor=new It(t,"fetch",(n,i,s)=>{for(const r of this._interceptionFilters)if(r.shouldIntercept(i,s))return this.shouldKeepFilter(r,i,s)||this.removeInterceptionFilter(r),r.intercept(i,s);return n(i,s)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,n,i){return typeof t.shouldKeep=="function"?t.shouldKeep(n,i):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};function Vt(e){return e=e instanceof URL?e:new URL(e,d().location.href),t=>typeof t=="string"?new URL(t,d().location.href).pathname===e.pathname:t instanceof URL?t.pathname===e.pathname:new URL(t.url,d().location.href).pathname===new URL(e,d().location.href).pathname}function $t(e,t,n){const i=new Response(t,n),s=new URL(e,location.toString());return Object.defineProperty(i,"url",{value:s}),i}function jt(e,t){const n=JSON.stringify(t),i=new Headers({"Content-Type":"application/json"});return $t(e,n,{headers:i})}const Mt=new Ot(d());function Et(e){return P().W.controller.descartesClient.getFeatures([0,0,0,0],{[e]:!0},{})}async function Tt(e,t){const n=P().W.Config.paths.features;Mt.addInterceptionFilter({shouldIntercept:Vt(n),intercept(){return Promise.resolve(jt(n,{[e]:{objects:[t]}}))}});const{[e]:i}=await Et(e),[s]=i.objects;return s.constructor}function Rt(e,t,n={}){const i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties={},i.geometry=e,i}function At(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!W(e[0])||!W(e[1]))throw new Error("coordinates must contain numbers");return Rt({type:"Point",coordinates:e},t,n)}function W(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function p(){return"unsafeWindow"in window?window.unsafeWindow:window}function Ft(e){const t=p().require("Waze/Action/CreateObject");return new t(e)}function Dt(e){p().W.model.actionManager.add(Ft(e))}function zt(e){return e.toISOString().slice(0,16).replace("T"," ")}function Pt(e){return p().W.model.mapComments.getObjectById(e)}function Ht(e,t){const n=p().require("Waze/Action/UpdateObject");return new n(e,t)}function Wt(e,t){p().W.model.actionManager.add(Ht(e,t))}let $;function qt(){if(!$)throw new Error("MapComment not initialized. Make sure to await the enhancedSDK function before using it.")}const xt=[{async install(){$=await Tt("mapComments",{geometry:At([0,0]).geometry})}},new z("DataModel.MapComments.addMapComment",e=>{qt();const t=new $({geoJSONGeometry:e.geometry,subject:e.subject,body:e.body,lockRank:e.lockRank,endDate:e.endDate?zt(e.endDate):null});return Dt(t),t.getID()}),new z("DataModel.MapComments.updateMapComment",({sdkInstance:e})=>t=>{const n=Pt(t.mapCommentId);if(!n)throw new e.Errors.DataModelNotFoundError("mapComment",t.mapCommentId);const i={};t.geometry&&(i.geoJSONGeometry=t.geometry),t.subject&&(i.subject=t.subject),t.body&&(i.body=t.body),t.lockRank&&(i.lockRank=t.lockRank),Wt(n,i)},{isFactory:!0})];var Nt=Object.defineProperty,Lt=(e,t,n)=>t in e?Nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t,n)=>Lt(e,typeof t!="symbol"?t+"":t,n),Ct=Object.defineProperty,Kt=(e,t,n)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_=(e,t,n)=>Kt(e,typeof t!="symbol"?t+"":t,n);let Ut=class{constructor(e,t){_(this,"_target"),_(this,"_key"),_(this,"_oldValue"),_(this,"_wasDefined",!1),_(this,"_isSwapped",!1),this._target=e,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(e){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=e,this._isSwapped=!0}};const Zt={onlyIfNotExists:!0,isFactory:!1};class j{constructor(t,n,i={}){if(k(this,"_installedInstances",new Map),k(this,"_path"),k(this,"_targetValue"),k(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=n,this._options={...Zt,...i}}_getTargetObject(t){let n=t;for(const i of this._path.slice(0,this._path.length-1))n[i]||(n[i]={}),n=n[i];return n}_createSwapper(t){const n=this._getTargetObject(t);return new Ut(n,this._path.at(-1))}install(t){if(this._installedInstances.has(t))return;const n=this._createSwapper(t);if(!(n.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const i=this._targetValue({nativeSdkInstance:t});n.swap(i)}else n.swap(this._targetValue);this._installedInstances.set(t,n)}}uninstall(t){const n=this._installedInstances.get(t);n&&(n.restore(),this._installedInstances.delete(t))}}var Gt=Object.defineProperty,Jt=(e,t,n)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t,n)=>Jt(e,typeof t!="symbol"?t+"":t,n);let q=class{constructor(e,t){f(this,"_target"),f(this,"_key"),f(this,"_oldValue"),f(this,"_wasDefined",!1),f(this,"_isSwapped",!1),this._target=e,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(e){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=e,this._isSwapped=!0}};function M(){return"unsafeWindow"in window?window.unsafeWindow:window}async function Bt(e){const t=[],n=new q(M().W.model.actionManager,"add");n.swap(i=>{t.push(i)});try{await e()}finally{n.restore()}return t}function Qt(e){return e.memoizedProps||{}}function Xt(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&Array.isArray(e.memoizedState)&&e.memoizedState.length===2&&"queue"in e&&e.queue===null&&Array.isArray(e.memoizedState[1])}function Yt(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&typeof e.memoizedState=="object"&&e.memoizedState!==null&&"current"in e.memoizedState&&"queue"in e&&e.queue===null}function te(e){return typeof e=="object"&&e!==null&&"memoizedState"in e&&"queue"in e&&typeof e.queue=="object"&&e.queue!==null&&"dispatch"in e.queue&&typeof e.queue.dispatch=="function"}function ee(e){return te(e)?{type:"useState",value:e.memoizedState,dispatch:e.queue.dispatch}:Xt(e)?{type:"useMemo",value:e.memoizedState[0],dependencies:e.memoizedState[1]}:Yt(e)?{type:"useRef",current:e.memoizedState}:null}function ne(e,t){const n=[];let i=e.memoizedState;for(;i;){const s=ee(i);s&&n.push(s),i=i.next}return n}function ie(e,t,n=1/0){let i=e,s=0;for(;i&&s<n;){const r=i.memoizedState?ne(i):[],F=Qt(i),w={fiber:i,hooks:{all:r,useState:r.filter(g=>g.type==="useState"),useMemo:r.filter(g=>g.type==="useMemo"),useRef:r.filter(g=>g.type==="useRef")},props:F};if(t(w))return w;i=i.return,s++}return null}const se="__reactFiber$";function re(e){const t=Object.keys(e).find(i=>i.startsWith(se));if(!t)throw new Error(`No fiber key found for element: ${e}`);const n=e[t];if(!n)throw new Error(`No fiber found for element: ${e}`);return n}const ae=e=>new Promise(t=>{const n=M(),i=new q(n.W.map.olMap,"addControl");i.swap(s=>{e==null||e(s),t(s),i.restore()})});function oe(e){const t=M(),n=t.W.userscripts.toOLGeometry(e);return new t.OpenLayers.Feature.Vector(n)}async function le(e,t){const n=ie(re(e),r=>"onClick"in r.props&&typeof r.props.onClick=="function");if(!n)throw new Error("No fiber found with draw initiator");const{onClick:i}=n.props;//! OpenLayers dependent code below - implementation might change over time
const s=ae(r=>{r.activate=()=>{}});i(new Event("click")),(await s).events.triggerEvent("featureadded",{feature:oe(t)})}var he=Object.defineProperty,ue=(e,t,n)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t,n)=>ue(e,typeof t!="symbol"?t+"":t,n);function ce(){return"unsafeWindow"in window?window.unsafeWindow:window}var de=Object.defineProperty,pe=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,l=(e,t,n)=>pe(e,typeof t!="symbol"?t+"":t,n);class _e{constructor(t,n){l(this,"_target"),l(this,"_key"),l(this,"_oldValue"),l(this,"_wasDefined",!1),l(this,"_isSwapped",!1),this._target=t,this._key=n,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class fe{constructor(t,n,i){l(this,"_enabled",!1),l(this,"_fnSwapper"),l(this,"_interceptionFunction"),l(this,"_middlewares",[]),this._fnSwapper=new _e(t,n),this._interceptionFunction=i}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled&&this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){this._fnSwapper.swap((...t)=>{if(!this._enabled)return this.callOriginalInvocator(...t);const n=this.runMiddlewares(t);if(n){if("output"in n)return n.output;"input"in n&&(t=n.input)}return this._interceptionFunction.call(this._fnSwapper.target,this.getOriginalInvocator(),...t)})}getOriginalInvocator(){return this._fnSwapper.originalValue.bind(this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const n of this._middlewares){const i=n(...t);if(i){if("output"in i)return i;"input"in i&&(t=i.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}class we{constructor(t){x(this,"_fetchInterceptor"),x(this,"_interceptionFilters",new Set),this._fetchInterceptor=new fe(t,"fetch",(n,i,s)=>{for(const r of this._interceptionFilters)if(r.shouldIntercept(i,s))return this.shouldKeepFilter(r,i,s)||this.removeInterceptionFilter(r),r.intercept(i,s);return n(i,s)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,n,i){return typeof t.shouldKeep=="function"?t.shouldKeep(n,i):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}}new we(ce());function ge(e,t,n={}){const i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties={},i.geometry=e,i}function me(e,t,n={}){for(const i of e){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return ge({type:"Polygon",coordinates:e},t,n)}function v(){return"unsafeWindow"in window?window.unsafeWindow:window}function ye(e,t,n){const i=new e(n),s=new t(i);return v().W.model.actionManager.add(s),i}function N(e){return v().W.model.permanentHazards.getObjectById(e)}function be(e,t){const n=v().require("Waze/Action/UpdateObject");return new n(e,t)}function Se(e,t){v().W.model.actionManager.add(be(e,t))}function ke(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}let E,T;const ve=[{async install(){const e=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(3) > wz-menu-item:nth-of-type(2)");if(!e||!(e instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await Bt(async()=>{await le(e,me([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_PERMANENT_HAZARD")throw new Error("Unexpected action discovered when tried to resolve AddPermanentHazard action: "+t.actionName);const n=t.object;if(!n)throw new Error("Unexpected state: Added object does not exist");if(n.type!=="permanentHazard")throw new Error("Unexpected state: Expected the added object to be a PermanentHazard instead of "+t.type);E=t.constructor,T=n.constructor}},new j("DataModel.PermanentHazards.addSchoolZone",e=>{if(!T||!E)throw new Error("PermanentHazard or AddPermanentHazard are not initialized. Make sure to await the enhancedSDK function before using it.");return ye(T,E,{type:9,geoJSONGeometry:e.geometry,name:e.name,speedLimit:e.speedLimit,excludedRoadTypes:e.excludedRoadTypes}).getID()}),new j("DataModel.PermanentHazards.updateSchoolZone",({sdkInstance:e})=>t=>{const n=N(t.schoolZoneId);if(!n||n.getAttribute("type")!==9)throw new e.Errors.DataModelNotFoundError("permanentHazard.SchoolZone",t.schoolZoneId);Se(n,ke({geoJSONGeometry:t.geometry,name:t.name,speedLimit:t.speedLimit,excludedRoadTypes:t.excludedRoadTypes}))},{isFactory:!0}),new j("DataModel.PermanentHazards.getSchoolZoneById",()=>e=>{const t=N(e.schoolZoneId);return!t||t.getAttribute("type")!==9?null:t},{isFactory:!0})],Ie={"Editing.Transactions":{hook:dt},"DataModel.MapComments":{hook:xt},"DataModel.PermanentHazards":{hook:ve}};function R(e){const[t,n,i]=e.split(".").map(Number);return{major:t,minor:n,patch:i}}function A(e,t){return e?t?e.major&&t.major&&e.major!==t.major?e.major-t.major:e.minor&&t.minor&&e.minor!==t.minor?e.minor-t.minor:e.patch&&t.patch&&e.patch!==t.patch?e.patch-t.patch:0:1:-1}function Oe(e,t,n="highest"){let i=null;typeof e.highest=="string"&&(e.highest=R(e.highest)),typeof e.lowest=="string"&&(e.lowest=R(e.lowest));for(const s of t){if(!s.version)continue;if(!i){i=s;continue}if(e.highest&&A(s.version,e.highest)>0||e.lowest&&A(s.version,e.lowest)<0)continue;const r=s.version,F=i.version,w=A(r,F);(n==="highest"&&w>0||n==="lowest"&&w<0)&&(i=s)}if(!i)throw new Error("No matching version found");return i}const Ve={"0.1":e=>{const t=e.constructor;return new t(e.getScriptId(),e.getScriptName())}};function $e(e){const t=Object.entries(Ve).map(([i,s])=>({version:R(i),cloner:s})),{cloner:n}=Oe({highest:e.getSDKVersion()},t);return n(e)}const L=new U(Ie);async function je(e,t={}){if(t.immutable&&(e=$e(e)),t.hooks)for(const n of t.hooks)await L.installHook(n,e);else await L.installAllHooks(e);return e}return je}();
