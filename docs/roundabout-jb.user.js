// ==UserScript==
// @name         WME Roundabout Junction Box
// @version      1.1.0
// @author       r0den
// @match        https://*.waze.com/*editor*
// @match        https://waze.com/*editor*
// @icon         https://www.waze.com/favicon.ico
// @description  Make a Junction Box same geometry as your roundabout
// @grant        none
// ==/UserScript==

(function(){var e=e||{};e.scope={};e.createTemplateTagFirstArg=function(a){return a.raw=a};e.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};e.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};e.arrayIterator=function(a){return{next:e.arrayIteratorImpl(a)}};e.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):e.arrayIterator(a)};
e.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};e.arrayFromIterable=function(a){return a instanceof Array?a:e.arrayFromIterator(e.makeIterator(a))};e.ASSUME_ES5=!1;e.ASSUME_NO_NATIVE_MAP=!1;e.ASSUME_NO_NATIVE_SET=!1;e.SIMPLE_FROUND_POLYFILL=!1;e.ISOLATE_POLYFILLS=!1;e.FORCE_POLYFILL_PROMISE=!1;e.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
e.objectCreate=e.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};e.defineProperty=e.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
e.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};e.global=e.getGlobal(this);e.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");e.TRUST_ES6_POLYFILLS=!e.ISOLATE_POLYFILLS||e.IS_SYMBOL_NATIVE;e.polyfills={};e.propertyToPolyfillSymbol={};
e.POLYFILL_PREFIX="$jscp$";e.polyfill=function(a,b,c,d){b&&(e.ISOLATE_POLYFILLS?e.polyfillIsolated(a,b,c,d):e.polyfillUnisolated(a,b,c,d))};e.polyfillUnisolated=function(a,b){var c=e.global;a=a.split(".");for(var d=0;d<a.length-1;d++){var g=a[d];if(!(g in c))return;c=c[g]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&e.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
e.polyfillIsolated=function(a,b,c){var d=a.split(".");a=1===d.length;var g=d[0];g=!a&&g in e.polyfills?e.polyfills:e.global;for(var h=0;h<d.length-1;h++){var f=d[h];if(!(f in g))return;g=g[f]}d=d[d.length-1];c=e.IS_SYMBOL_NATIVE&&"es6"===c?g[d]:null;b=b(c);null!=b&&(a?e.defineProperty(e.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===e.propertyToPolyfillSymbol[d]&&(a=1E9*Math.random()>>>0,e.propertyToPolyfillSymbol[d]=e.IS_SYMBOL_NATIVE?e.global.Symbol(d):e.POLYFILL_PREFIX+a+"$"+
d),e.defineProperty(g,e.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:b})))};
e.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if(e.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,g){c=b(c,d);g&&Reflect.setPrototypeOf(c,g.prototype);return c}}return function(c,d,g){void 0===g&&(g=c);g=e.objectCreate(g.prototype||Object.prototype);return Function.prototype.apply.call(c,g,d)||g}};e.construct={valueOf:e.getConstructImplementation}.valueOf();
e.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};e.setPrototypeOf=e.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:e.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
e.inherits=function(a,b){a.prototype=e.objectCreate(b.prototype);a.prototype.constructor=a;if(e.setPrototypeOf){var c=e.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};e.generator={};e.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
e.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};e.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};e.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
e.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};e.generator.Context.prototype.next_=function(a){this.yieldResult=a};e.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};e.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
e.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};e.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};e.generator.Context.prototype.yieldAll=function(a,b){a=e.makeIterator(a);var c=a.next();e.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
e.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};e.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};e.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};e.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};e.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
e.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};e.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
e.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};e.generator.Context.prototype.forIn=function(a){return new e.generator.Context.PropertyIterator(a)};
e.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};e.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};e.generator.Engine_=function(a){this.context_=new e.generator.Context;this.program_=a};
e.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};e.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
e.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
e.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);e.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var g=d.value}catch(h){return this.context_.yieldAllIterator_=null,this.context_.throw_(h),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,g);return this.nextStep_()};
e.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
e.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};e.generator.createGenerator=function(a,b){b=new e.generator.Generator_(new e.generator.Engine_(b));e.setPrototypeOf&&a.prototype&&e.setPrototypeOf(b,a.prototype);return b};e.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");
e.polyfill("Reflect.construct",function(){return e.construct},"es6","es3");e.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if(e.setPrototypeOf){var b=e.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(g){return!1}}}return null},"es6","es5");e.initSymbol=function(){};
e.polyfill("Symbol",function(a){function b(h){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(h||"")+"_"+g++,h)}function c(h,f){this.$jscomp$symbol$id_=h;e.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})}if(a)return a;c.prototype.toString=function(){return this.$jscomp$symbol$id_};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",g=0;return b},"es6","es3");
e.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=e.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&e.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return e.iteratorPrototype(e.arrayIteratorImpl(this))}})}return a},"es6","es3");
e.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};e.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");e.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var g=d.length;c=c||0;for(0>c&&(c=Math.max(c+g,0));c<g;c++){var h=d[c];if(h===b||Object.is(h,b))return!0}return!1}},"es7","es3");
e.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};e.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==e.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
e.polyfill("Array.prototype.flatMap",function(a){return a?a:function(b,c){for(var d=[],g=0;g<this.length;g++){var h=b.call(c,this[g],g,this);Array.isArray(h)?d.push.apply(d,h):d.push(h)}return d}},"es9","es5");e.polyfill("Array.prototype.flat",function(a){return a?a:function(b){b=void 0===b?1:b;for(var c=[],d=0;d<this.length;d++){var g=this[d];Array.isArray(g)&&0<b?(g=Array.prototype.flat.call(g,b-1),c.push.apply(c,g)):c.push(g)}return c}},"es9","es5");
e.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};e.assign=e.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var g in d)e.owns(d,g)&&(a[g]=d[g])}return a};e.polyfill("Object.assign",function(a){return a||e.assign},"es6","es3");
e.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,g=0;g<d;g++){var h=a[g];if(b.call(c,h,g,a))return{i:g,v:h}}return{i:-1,v:void 0}};e.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return e.findInternal(this,b,c).v}},"es6","es3");
e.polyfill("Promise",function(a){function b(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var l=this.createResolveAndReject_();try{f(l.resolve,l.reject)}catch(k){l.reject(k)}}function c(){this.batch_=null}function d(f){return f instanceof b?f:new b(function(l){l(f)})}if(a&&(!(e.FORCE_POLYFILL_PROMISE||e.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof e.global.PromiseRejectionEvent)||!e.global.Promise||-1===e.global.Promise.toString().indexOf("[native code]")))return a;
c.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(f)};var g=e.global.setTimeout;c.prototype.asyncExecuteFunction=function(f){g(f,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var l=0;l<f.length;++l){var k=f[l];f[l]=null;try{k()}catch(r){this.asyncThrow_(r)}}}this.batch_=null};c.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;
})};b.prototype.createResolveAndReject_=function(){function f(r){return function(t){k||(k=!0,r.call(l,t))}}var l=this,k=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};b.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof b)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var l=null!=f;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(f):this.fulfill_(f)}};
b.prototype.resolveToNonPromiseObj_=function(f){var l=void 0;try{l=f.then}catch(k){this.reject_(k);return}"function"==typeof l?this.settleSameAsThenable_(l,f):this.fulfill_(f)};b.prototype.reject_=function(f){this.settle_(2,f)};b.prototype.fulfill_=function(f){this.settle_(1,f)};b.prototype.settle_=function(f,l){if(0!=this.state_)throw Error("Cannot settle("+f+", "+l+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=l;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};b.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;g(function(){if(f.notifyUnhandledRejection_()){var l=e.global.console;"undefined"!==typeof l&&l.error(f.result_)}},1)};b.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=e.global.CustomEvent,l=e.global.Event,k=e.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):"function"===typeof l?
f=new l("unhandledrejection",{cancelable:!0}):(f=e.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return k(f)};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)h.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var h=new c;b.prototype.settleSameAsPromise_=function(f){var l=this.createResolveAndReject_();f.callWhenSettled_(l.resolve,
l.reject)};b.prototype.settleSameAsThenable_=function(f,l){var k=this.createResolveAndReject_();try{f.call(l,k.resolve,k.reject)}catch(r){k.reject(r)}};b.prototype.then=function(f,l){function k(q,p){return"function"==typeof q?function(n){try{r(q(n))}catch(u){t(u)}}:p}var r,t,m=new b(function(q,p){r=q;t=p});this.callWhenSettled_(k(f,r),k(l,t));return m};b.prototype.catch=function(f){return this.then(void 0,f)};b.prototype.callWhenSettled_=function(f,l){function k(){switch(r.state_){case 1:f(r.result_);
break;case 2:l(r.result_);break;default:throw Error("Unexpected state: "+r.state_);}}var r=this;null==this.onSettledCallbacks_?h.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};b.resolve=d;b.reject=function(f){return new b(function(l,k){k(f)})};b.race=function(f){return new b(function(l,k){for(var r=e.makeIterator(f),t=r.next();!t.done;t=r.next())d(t.value).callWhenSettled_(l,k)})};b.all=function(f){var l=e.makeIterator(f),k=l.next();return k.done?d([]):new b(function(r,
t){function m(n){return function(u){q[n]=u;p--;0==p&&r(q)}}var q=[],p=0;do q.push(void 0),p++,d(k.value).callWhenSettled_(m(q.length-1),t),k=l.next();while(!k.done)})};return b},"es6","es3");var x,B=x||(x={});B[B.Yes=0]="Yes";B[B.Locked=1]="Locked";B[B.SegmentsLocked=2]="SegmentsLocked";B[B.TurnFeatureLocked=3]="TurnFeatureLocked";B[B.PropertiesCopied=4]="PropertiesCopied";
function F(a){return a.attributes.segIDs.map(function(b){b=W.model.segments.getObjectById(b);return(b.attributes.toCrossroads.includes(a.attributes.id)?b.getToNode():b.getFromNode()).attributes.segIDs.filter(function(c){c=W.model.segments.getObjectById(c);var d=c.attributes.toCrossroads.includes(a.attributes.id),g=c.attributes.fromCrossroads.includes(a.attributes.id),h=c.attributes.revDirection;return c.attributes.fwdDirection&&d||h&&g&&(d&&!g||!d&&g)})}).flatMap(function(b){return W.model.segments.getObjectById(b)})}
function H(a,b){var c={entrances:[],exits:[]};(function(){var d=a.attributes.segIDs.map(function(g){g=W.model.segments.getObjectById(g);return[g.getToNode().attributes.segIDs,g.getFromNode().attributes.segIDs].flat()});d=d.flat();return d=d.filter(function(g,h,f){return f.indexOf(g)===h})})().forEach(function(d){d=W.model.segments.getObjectById(d);var g=d.attributes.toCrossroads.includes(a.attributes.id)||d.attributes.toCrossroads.includes(b)||d.attributes.crossroadID===a.attributes.id,h=d.attributes.fromCrossroads.includes(a.attributes.id)||
d.attributes.fromCrossroads.includes(b)||d.attributes.crossroadID===a.attributes.id,f=d.attributes.fwdDirection,l=d.attributes.revDirection;if(g&&!h||!g&&h)h&&(l&&c.entrances.push(d),f&&c.exits.push(d)),g&&(f&&c.entrances.push(d),l&&c.exits.push(d))});c.entrances=c.entrances.filter(function(d,g){for(var h=0;h<c.entrances.length;h++)if(c.entrances[h].attributes.id===d.attributes.id)return h===g;return!0});c.exits=c.exits.filter(function(d,g){for(var h=0;h<c.exits.length;h++)if(c.exits[h].attributes.id===
d.attributes.id)return h===g;return!0});return c}function I(a,b){return b.flatMap(function(c){var d=c.attributes.toCrossroads.includes(a.attributes.id);return a.getTurnsFrom(d?require("Waze/Model/Graph/Vertex").forwardOf(c.attributes.id):require("Waze/Model/Graph/Vertex").reverseOf(c.attributes.id))})}
function J(a,b,c){if(a.attributes.rank>W.loginManager.user.rank)return x.Locked;b||(b=F(a));return b.some(function(d){return d.getLockRank()>W.loginManager.user.rank})?x.SegmentsLocked:(c||I(a,b)).some(function(d){var g=W.model.segments.getObjectById(d.fromVertex.segmentID),h=W.model.segments.getObjectById(d.toVertex.segmentID);d=d.getTurnData().hasTurnGuidance();g=Math.max(g.getAddress().getCountry().allowEditingTurnGuidanceRank,h.getAddress().getCountry().allowEditingTurnGuidanceRank);return d&&
g>W.loginManager.user.rank})?x.TurnFeatureLocked:x.Yes};var K={en:{save:{changes_log:{actions:{AddRoundaboutJunction:"Added roundabout junction",NormalizeRoundaboutTurns:"Normalized roundabout turns",PasteJunctionBoxProps:"Pasted junction box properties"}}},edit:{big_junction:{convert_to_roundabout:"Convert to roundabout junction",copy_props:"Copy junction properties",paste_props:"Paste junction properties",errors:{locked:"The junction box is locked.",segments_locked:"Some of the segments are locked.",turn_feature_locked:"Some of the turns have guidance instructions. Editing turn guidance unlocks at a higher level.",
no_saved_props:"No copied junction box properties to paste.",props_already_saved:"This junction box properties already copied and saved, you can safely remove the junction box.",no_changes:"This junction box properties are identical to what you have copied.",missing_entrances_exits:"Some of the entrances or exits are missing. Make sure you've included all of them in the junction box."},override_copied_props:"There are already copied junction box properties, copying again will override the already copied properties.\nDo you want to override the copied properties?"},
segment:{normalize_roundabout_turns:"Normalize turns at node %{node}",normalize_roundabout_turns_disabled:{not_connected_to_jb:"This node is not connected to a junction box. Add a junction box before normalizing instructions.",exit_count_not_supported:"This roundabout has %{exit_count} exit(s)."}}}},he:{save:{changes_log:{actions:{AddRoundaboutJunction:"\u05e7\u05d5\u05e4\u05e1\u05ea \u05db\u05d9\u05db\u05e8 \u05d4\u05d5\u05e1\u05e4\u05d4",NormalizeRoundaboutTurns:"\u05d4\u05e0\u05d7\u05d9\u05d5\u05ea \u05d1\u05db\u05d9\u05db\u05e8 \u05e1\u05d5\u05d3\u05e8\u05d5",
PasteJunctionBoxProps:"\u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e7\u05d5\u05e4\u05e1\u05ea \u05e6\u05d5\u05de\u05ea \u05d4\u05d5\u05d3\u05d1\u05e7\u05d5"}}},edit:{big_junction:{convert_to_roundabout:"\u05e9\u05e0\u05d4 \u05dc\u05e7\u05d5\u05e4\u05e1\u05ea \u05db\u05d9\u05db\u05e8",copy_props:"\u05d4\u05e2\u05ea\u05e7\u05ea \u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e6\u05d5\u05de\u05ea",paste_props:"\u05d4\u05d3\u05d1\u05e7\u05ea \u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e6\u05d5\u05de\u05ea",errors:{locked:"\u05e7\u05d5\u05e4\u05e1\u05ea \u05d4\u05e6\u05d5\u05de\u05ea \u05e0\u05e2\u05d5\u05dc\u05d4.",
segments_locked:"\u05d7\u05dc\u05e7 \u05de\u05d4\u05de\u05e7\u05d8\u05e2\u05d9\u05dd \u05e0\u05e2\u05d5\u05dc\u05d9\u05dd.",turn_feature_locked:"\u05dc\u05d7\u05dc\u05e7 \u05de\u05d4\u05e4\u05e0\u05d9\u05d5\u05ea \u05d9\u05e9 \u05d4\u05d2\u05d3\u05e8\u05ea \u05d4\u05e0\u05d7\u05d9\u05d5\u05ea. \u05d0\u05e4\u05e9\u05e8\u05d5\u05ea \u05dc\u05e2\u05e8\u05d5\u05da \u05d0\u05d5\u05ea\u05dd \u05e0\u05e4\u05ea\u05d7\u05ea \u05d1\u05e8\u05de\u05d4 \u05d2\u05d1\u05d5\u05d4\u05d4 \u05d9\u05d5\u05ea\u05e8.",
no_saved_props:"\u05d0\u05d9\u05df \u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05d6\u05de\u05d9\u05e0\u05d5\u05ea \u05e9\u05dc \u05e7\u05d5\u05e4\u05e1\u05ea \u05e6\u05d5\u05de\u05ea.",props_already_saved:"\u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e7\u05d5\u05e4\u05e1\u05ea \u05d4\u05e6\u05d5\u05de\u05ea \u05db\u05d1\u05e8 \u05d4\u05d5\u05e2\u05ea\u05e7\u05d5 \u05d5\u05e0\u05e9\u05de\u05e8\u05d5, \u05d0\u05ea\u05d4 \u05d9\u05db\u05d5\u05dc \u05dc\u05d4\u05e1\u05d9\u05e8 \u05d0\u05ea \u05e7\u05d5\u05e4\u05e1\u05ea \u05d4\u05e6\u05d5\u05de\u05ea \u05d1\u05d1\u05d8\u05d7\u05d4.",
no_changes:"\u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e7\u05d5\u05e4\u05e1\u05ea \u05e6\u05d5\u05de\u05ea \u05d6\u05d5 \u05d6\u05d4\u05d5\u05ea \u05dc\u05de\u05d4 \u05e9\u05d4\u05e2\u05ea\u05e7\u05ea\u05dd.",missing_entrances_exits:"\u05d7\u05dc\u05e7 \u05de\u05d4\u05db\u05e0\u05d9\u05e1\u05d5\u05ea \u05d0\u05d5 \u05d4\u05d9\u05e6\u05d9\u05d0\u05d5\u05ea \u05dc\u05d0 \u05e7\u05d9\u05d9\u05de\u05d5\u05ea \u05d1\u05e7\u05d5\u05e4\u05e1\u05ea \u05e6\u05d5\u05de\u05ea \u05d6\u05d5. \u05d5\u05d3\u05d0 \u05e9\u05db\u05dc\u05dc\u05ea \u05d0\u05ea \u05db\u05d5\u05dc\u05dd \u05d1\u05e7\u05d5\u05e4\u05e1\u05ea \u05d4\u05e6\u05d5\u05de\u05ea."},
override_copied_props:"\u05d9\u05e9\u05e0\u05dd \u05db\u05d1\u05e8 \u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05de\u05d5\u05e2\u05ea\u05e7\u05d5\u05ea, \u05d4\u05e2\u05ea\u05e7\u05d4 \u05e0\u05d5\u05e1\u05e4\u05ea \u05ea\u05d7\u05dc\u05d9\u05e3 \u05d0\u05ea \u05d4\u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e9\u05d4\u05d5\u05e2\u05ea\u05e7\u05d5 \u05db\u05d1\u05e8.\n\u05d4\u05d0\u05dd \u05d0\u05ea/\u05d4 \u05d1\u05d8\u05d5\u05d7 \u05e9\u05d1\u05e8\u05e6\u05d5\u05e0\u05da \u05dc\u05d4\u05e2\u05ea\u05d9\u05e7 \u05d0\u05ea \u05d4\u05ea\u05db\u05d5\u05e0\u05d5\u05ea \u05e9\u05dc \u05e7\u05d5\u05e4\u05e1\u05ea \u05d4\u05e6\u05d5\u05de\u05ea?"},
segment:{normalize_roundabout_turns:"\u05e1\u05d3\u05e8 \u05d4\u05e0\u05d7\u05d9\u05d5\u05ea \u05d1\u05e6\u05d5\u05de\u05ea %{node}",normalize_roundabout_turns_disabled:{not_connected_to_jb:"\u05e6\u05d5\u05de\u05ea \u05d6\u05d5 \u05d0\u05d9\u05e0\u05d4 \u05de\u05d7\u05d5\u05d1\u05e8\u05ea \u05dc\u05e7\u05d5\u05e1\u05e4\u05ea \u05e6\u05d5\u05de\u05ea. \u05d4\u05d5\u05e1\u05e3 \u05e7\u05d5\u05e4\u05e1\u05ea \u05e6\u05d5\u05de\u05ea \u05dc\u05e4\u05e0\u05d9 \u05e1\u05d9\u05d3\u05d5\u05e8 \u05d4\u05d4\u05e0\u05d7\u05d9\u05d5\u05ea.",
exit_count_not_supported:"\u05dc\u05db\u05d9\u05db\u05e8 \u05d6\u05d5 \u05d9\u05e9 %{exit_count} \u05d9\u05e6\u05d9\u05d0\u05d5\u05ea."}}}},ru:{save:{changes_log:{actions:{AddRoundaboutJunction:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430 \u0441\u0445\u0435\u043c\u0430 \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u043a\u0440\u0443\u0433\u043e\u0432\u043e\u0433\u043e \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",NormalizeRoundaboutTurns:"\u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u043f\u043e\u0432\u043e\u0440\u043e\u0442\u044b \u043a\u0440\u0443\u0433\u043e\u0432\u043e\u0433\u043e \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",
PasteJunctionBoxProps:"\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u0432\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u044b"}}},edit:{big_junction:{convert_to_roundabout:"\u041f\u0440\u0435\u043e\u0431. \u0432 \u0441\u0445\u0435\u043c\u0443 \u043a\u0440\u0443\u0433. \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f",copy_props:"\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0441\u0445\u0435\u043c\u044b",
paste_props:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0441\u0445\u0435\u043c\u044b",errors:{locked:"\u0421\u0445\u0435\u043c\u0430 \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430.",segments_locked:"\u041d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u044b \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u044b.",
turn_feature_locked:"\u0423 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e\u0432\u043e\u0440\u043e\u0442\u043e\u0432 \u0435\u0441\u0442\u044c \u043f\u043e\u0434\u0441\u043a\u0430\u0437\u043a\u0438. \u0418\u0445 \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043d\u0430 \u0431\u043e\u043b\u0435\u0435 \u0432\u044b\u0441\u043e\u043a\u043e\u043c \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440\u0441\u043a\u043e\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f.",
no_saved_props:"\u041d\u0435\u0442 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0441\u0432\u043e\u0439\u0441\u0442\u0432 \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u0434\u043b\u044f \u0432\u0441\u0442\u0430\u0432\u043a\u0438.",props_already_saved:"\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u044d\u0442\u043e\u0439 \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u0443\u0436\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b, \u043c\u043e\u0436\u043d\u043e \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0445\u0435\u043c\u0443 \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438.",
no_changes:"\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u044b \u0442\u0435\u043c, \u0447\u0442\u043e \u0432\u044b \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043b\u0438.",missing_entrances_exits:"\u041d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u0445\u043e\u0434\u044b \u0438\u043b\u0438 \u0432\u044b\u0445\u043e\u0434\u044b \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442. \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0432\u044b \u0432\u043a\u043b\u044e\u0447\u0438\u043b\u0438 \u0438\u0445 \u0432\u0441\u0435\u0445 \u0432 \u0441\u0445\u0435\u043c\u0443 \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438."},
override_copied_props:"\u0423\u0436\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u044b \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438, \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e\u0435 \u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u0443\u0436\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430.\n\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?"},
segment:{normalize_roundabout_turns:"\u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0432\u043e\u0440\u043e\u0442\u044b \u0441 \u0443\u0437\u043b\u044f %{node}",normalize_roundabout_turns_disabled:{not_connected_to_jb:"\u042d\u0442\u043e\u0442 \u0443\u0437\u0435\u043b \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d \u043a \u0441\u0445\u0435\u043c\u044b \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438. \u0414\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0441\u0445\u0435\u043c\u0443 \u0440\u0430\u0437\u0432\u044f\u0437\u043a\u0438 \u043f\u0435\u0440\u0435\u0434 \u043d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0435\u0439 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439.",
exit_count_not_supported:"\u0423 \u044d\u0442\u043e\u0433\u043e \u043a\u0440\u0443\u0433\u043e\u0432\u043e\u0433\u043e \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f \u0435\u0441\u0442\u044c %{exit_count} \u0441\u044a\u0435\u0437\u0434(\u043e\u0432)."}}}}};function L(){this.defaultLocale="en";this.separatorChar=".";this._locale=this.getLocaleOrDefault(I18n.locale)}L.prototype.localeExists=function(a){return!!K[a]};L.prototype.getLocaleOrDefault=function(a){return this.localeExists(a)?a:this.defaultLocale};
L.prototype.translateByLocale=function(a,b,c){for(var d=[],g=2;g<arguments.length;++g)d[g-2]=arguments[g];g=this.translations[a];for(var h=0;h<b.length;h++)if(g=g[b[h]],!g)return null;if("string"!==typeof g||0===g.length)return null;d=e.makeIterator(d);for(h=d.next();!h.done;h=d.next()){var f=e.makeIterator(h.value);h=f.next().value;f=f.next().value;g=g.replace("%{"+h+"}",f)}return g};
L.prototype.translate=function(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];d=a.split(this.separatorChar);return this.translateByLocale.apply(this,[this.locale,d].concat(e.arrayFromIterable(c)))||this.translateByLocale.apply(this,[this.defaultLocale,d].concat(e.arrayFromIterable(c)))||d[d.length-1]};e.global.Object.defineProperties(L.prototype,{locale:{configurable:!0,enumerable:!0,get:function(){return this._locale}},translations:{configurable:!0,enumerable:!0,get:function(){return K}}});function M(){var a=W.app.trigger;W.app.trigger=function(c){a.apply(this,arguments);if("selectionChanged"===c){var d=W.selectionManager._selectedFeatures;if(0!==d.length&&"bigJunction"===d[0].model.type&&0>d[0].model.attributes.id){d=document.querySelector(".controls.junction-actions").parentElement;var g=d.classList.remove;d.classList.remove=function(f){"side-panel-section"!==f&&g.apply(this,arguments)};var h=d.classList.add;d.classList.add=function(f){"more-actions"!==f&&h.apply(this,arguments)}}}};
var b=document.createElement("style");b.innerHTML="\n        #big-junction-edit-general .form-group.side-panel-section .controls.junction-actions > *:not(:first-child) {\n            margin-top: 4px;\n        }\n    ";document.head.appendChild(b)};function N(a){if(0==W.model.junctions.objects.hasOwnProperty(a))return null;var b=W.model.junctions.objects[a].attributes.segIDs;if(0==b.length)return null;for(var c=0;c<b.length&&0==W.model.segments.objects.hasOwnProperty(b[c]);)c++;if(c==b.length)return null;var d=W.model.segments.objects[b[c]];b=b[c];c=[];for(var g=!1;!g;){var h=d.geometry.getVertices();if(d.attributes.fwdDirection){for(var f=0;f<h.length-1;f++)c.push(h[f].clone());h=W.model.nodes.objects[d.attributes.toNodeID]}else{for(f=h.length-
1;0<f;f--)c.push(h[f].clone());h=W.model.nodes.objects[d.attributes.fromNodeID]}var l=null;for(f=0;f<h.attributes.segIDs.length;f++)if(l=W.model.segments.objects[h.attributes.segIDs[f]],l.attributes.id!=d.attributes.id&&null!=l.attributes.junctionID&&l.attributes.junctionID==a){if(l.attributes.id==b){g=!0;break}break}if(!g&&l.attributes.id==d.attributes.id)return null;d=l}a=new OpenLayers.Geometry.LinearRing(c);a=a.resize(1.2,a.getCentroid());a=new OpenLayers.Geometry.Polygon(a);a.calculateBounds();
return a}
function O(a){var b={},c=null;W.model.actionManager.events.on("beforeaction",function(d){var g=d.action;g.hasOwnProperty("bigJunction")&&(c=function(){var h=W.model.segments.objects[g.bigJunction.attributes.segIDs[0]].attributes.junctionID;if(null!=h&&(h=N(h),null!=h)){g._description=a.translate("save.changes_log.actions.AddRoundaboutJunction");g.initialGeometry=g.bigJunction.attributes.geometry=h;var f=W.selectionManager.getSelectedFeatures()[0],l=f.layer;l.geometry=h;var k=l._featureMap[f.model.attributes.id];l.removeFeatures(k);
k.geometry=h;l.addFeatures(k);return b[f.model.attributes.id]=!0}})});W.model.actionManager.events.on("afteraction",function(d){d=d.action;c&&(0===d.bigJunction.attributes.segIDs.filter(function(g){return!W.model.segments.objects[g].isInRoundabout()}).length&&(b[d.bigJunction.attributes.id]=c),c=null)});W.selectionManager.events.on("selectionchanged",function(d){d=d.selected;if(0!=d.length&&"bigJunction"==d[0].model.type&&!(0<=d[0].model.attributes.junctionID)){var g=b[d[0].model.attributes.id];if("undefined"!==
typeof g){var h=document.getElementById("big-junction-edit-general").getElementsByClassName("junction-actions")[0],f=h.parentNode;f.classList.remove("side-panel-section");f.classList.add("more-actions");var l=document.createElement("button");l.classList.add("action-button","select-short-segments","waze-btn","waze-btn-smaller","waze-btn-white");l.innerHTML=a.translate("edit.big_junction.convert_to_roundabout");if(!0===g)l.disabled=!0;else{var k=d[0].model.attributes.id;l.onclick=function(){b[k]();
l.disabled=!0}}h.appendChild(l)}}})};function P(a,b){function c(d,g,h){var f=b.call(this)||this;f.fromSegment=g;f.atNode=h;f.subActions.push.apply(f.subActions,d);return f}e.inherits(c,b);c.prototype.getFocusFeatures=function(){return[this.fromSegment,this.atNode]};c.prototype.getAffectedUniqueIds=function(){return[this.fromSegment.getUniqueID()]};c.prototype.generateDescription=function(){this._description=a.translate("save.changes_log.actions.NormalizeRoundaboutTurns")};c.prototype.doAction=function(){return!this.subActions.map(function(d){return d.doAction()}).some(function(d){return!1===
d})};c.prototype.setModel=function(d){this.model=d;this.subActions.forEach(function(g){return g.setModel(d)})};W.selectionManager.events.on("selectionchanged",function(d){function g(m){var q=m.getSegmentIds().filter(function(p){return p!==t.attributes.id});return 0===q.length?!1:0<q.filter(function(p){return!W.model.segments.getObjectById(p).isInRoundabout()}).length?!1:m.isConnectedToBigJunction()?!0:"jb"}function h(m){m=require("Waze/Model/Graph/Vertex")[m+"Of"](t.getID());m=W.model.turnGraph.getTurnsFrom(m);
return m=m.filter(function(q){return 0<q.turnData.segmentPath.length}).sort(function(q,p){return q.turnData.segmentPath.length<p.turnData.segmentPath.length?-1:1})}function f(m,q){var p=["TURN_RIGHT","CONTINUE","TURN_LEFT","UTURN"],n=["TURN_LEFT","CONTINUE","TURN_RIGHT","UTURN"],u=r[0].model.getAddress().getCountry().leftHandTraffic,y=require("Waze/Model/Graph/Actions/SetTurn");m=m.map(function(D,C){return new y(W.model.turnGraph,D.withTurnData(D.turnData.withInstructionOpcode((u?n:p)[C%p.length])))});
W.model.actionManager.add(new c(m,t,q))}function l(m,q,p,n){var u=document.createElement("div");u.className="edit-house-numbers-btn-wrapper waze-tooltip";u.setAttribute("data-toggle","tooltip");u.setAttribute("data-original-title",n);var y=document.createElement("button");y.className="action-button waze-btn waze-btn-white";y.innerText=a.translate("edit.segment.normalize_roundabout_turns",["node",q]);null===n?y.onclick=f.bind(this,m,p):(y.disabled=!0,y.style.pointerEvents="none");m=document.querySelector("#segment-edit-general .form-group.more-actions");
u.appendChild(y);m.appendChild(u);y.disabled&&$(u).tooltip({container:"body"})}function k(m,q,p){var n=g(m);if(!1!==n){q=h(q);var u=null;"jb"===n?u=a.translate("edit.segment.normalize_roundabout_turns_disabled.not_connected_to_jb"):4!==q.length&&(u=a.translate("edit.segment.normalize_roundabout_turns_disabled.exit_count_not_supported",["exit_count",q.length]));l(q,p,m,u)}}var r=d.selected;if(1===r.length&&"segment"===r[0].model.type){var t=r[0].model;t.isInRoundabout()||(t.attributes.revDirection&&
k(t.getNodeByDirection("from"),"reverse","A"),t.attributes.fwdDirection&&k(t.getNodeByDirection("to"),"forward","B"))}})};function Q(a,b){function c(m,q,p){var n=b.call(this)||this;n.subActions=m;n.object=q;n.attributes=n.oldAttributes=q.attributes;n.newAttributes=p;n.affectingChangableActions=k.changeableActions;return n}function d(m){m.disabled=!1;m.parentNode.removeAttribute("data-original-title");m.style.pointerEvents="auto"}function g(m,q){m.disabled=!0;m.parentNode.setAttribute("data-original-title",q);m.style.pointerEvents="none";$(m.parentElement).tooltip({container:"body"})}function h(){function m(p,n){p=e.makeIterator(p);
for(var u=p.next();!u.done;u=p.next())if(u=u.value,u.getID()==n||u.hasOwnProperty("subActions")&&m(u.subActions,n))return!0;return!1}if(null===k)return!0;var q=W.model.actionManager._undoStack;return k.changeableActions.some(function(p){return m(q,p)})}function f(){r&&t&&(h()?(d(r),d(t)):(g(r,a.translate("edit.big_junction.errors.props_already_saved")),g(t,a.translate("edit.big_junction.errors.no_changes"))))}function l(m,q){var p=m.action;if(null!==k){if(p.bigJunction&&p.bigJunction.attributes.id===
k.copiedJunctionId)k.changeableActions.push(p.getID());else{if("Waze.Action.SetTurn"==p.CLASS_NAME&&k.entrances.includes(p._turn.fromVertex.segmentID)){m=W.model.bigJunctions.getObjectById(k.copiedJunctionId);if(!m)return;m=m.getTurnsFrom(p._turn.fromVertex);m.filter(function(u){return u.toVertex.segmentID==p._turn.toVertex.segmentID&&u.turnData.segmentPath==p._turn.turnData.segmentPath}).length!=m.length&&k.changeableActions.push(p.getID())}if(p.subActions){m=e.makeIterator(p.subActions);for(var n=
m.next();!n.done;n=m.next())l({action:n.value},!0)}}q||f()}}var k=null,r=null,t=null;e.inherits(c,b);c.prototype.getFocusFeatures=function(){return[this.object]};c.prototype.getAffectedUniqueIds=function(){return[this.object.getUniqueID()]};c.prototype.generateDescription=function(){this._description=a.translate("save.changes_log.actions.PasteJunctionBoxProps")};c.prototype.doAction=function(){k.changeableActions=[];this.repository=this.model.getRepository(this.object.getType());Object.assign(this.attributes,
this.newAttributes);this.hasChanges&&(this.object.isUnchanged()&&(this.object.setState("UPDATE"),this.stateChanged=!0),this.repository.changed(this.object));return!this.subActions.map(function(m){return m.doAction()}).some(function(m){return!1===m})};c.prototype.undoAction=function(){Object.assign(this.attributes,this.oldAttributes);this.stateChanged&&this.object.setState(null);this.repository.changed(this.object);this.subActions.forEach(function(m){return m.undoAction()});k.changeableActions=this.affectingChangableActions};
c.prototype.setModel=function(m){this.model=m;this.subActions.forEach(function(q){return q.setModel(m)})};c.prototype.serialize=function(){var m=this.newAttributes;m.id=this.object.getID();return{_objectType:this.object.getType(),action:"UPDATE",attributes:m}};e.global.Object.defineProperties(c.prototype,{hasChanges:{configurable:!0,enumerable:!0,get:function(){return 0!==this.newAttributes.length}}});W.selectionManager.events.on("selectionchanged",function(m){function q(){if(k.attributes.name!=n[0].model.attributes.name||
k.attributes.cityID!=n[0].model.attributes.cityID||k.attributes.rank!=n[0].model.attributes.rank||k.attributes.segIDs!=n[0].model.attributes.segIDs||k.turns.length!=D.length)return!0;for(var v=0;v<k.turns.length;v++)if(k.turns[v].turnData.segmentPath!=D[v].turnData.segmentPath||k.turns[v].fromVertex.segmentID!=D[v].fromVertex.segmentID||k.turns[v].toVertex.segmentID!=D[v].toVertex.segmentID)return!0;return!1}function p(v,z,w,G){var A=document.createElement("div");A.setAttribute("data-original-title",
w||"");A.setAttribute("data-toggle","tooltip");$(A).tooltip({container:"body"});w=document.createElement("button");w.className="action-button waze-btn waze-btn-smaller waze-btn-white";G||(w.setAttribute("disabled",""),w.style.pointerEvents="none");w.onclick=v;w.innerText=z;A.appendChild(w);document.querySelector(".controls.junction-actions").appendChild(A);return[w,A]}var n=m.selected;r=t=null;if(1===n.length&&"bigJunction"==n[0].model.type){m=H(n[0].model,null!==k?k.copiedJunctionId:null);var u=
m.entrances,y=m.exits,D=I(n[0].model,u);m=h()||k.copiedJunctionId!==n[0].model.attributes.id?J(n[0].model,u,D):x.PropertiesCopied;var C=null;switch(m){case x.Locked:C="edit.big_junction.errors.locked";break;case x.SegmentsLocked:C="edit.big_junction.errors.segments_locked";break;case x.TurnFeatureLocked:C="edit.big_junction.errors.turn_feature_locked";break;case x.PropertiesCopied:C="edit.big_junction.errors.props_already_saved"}null!==C&&(C=a.translate(C));var E=null;m==x.Locked?E="edit.big_junction.errors.locked":
null===k?E="edit.big_junction.errors.no_saved_props":k.entrances.some(function(v){return!u.some(function(z){return z.getID()==v})})||k.exits.some(function(v){return!y.some(function(z){return z.getID()==v})})?E="edit.big_junction.errors.missing_entrances_exits":m===x.Yes||q()||(E="edit.big_junction.errors.no_changes");null!==E&&(E=a.translate(E));r=p(function(){if(null===k||confirm(a.translate("edit.big_junction.override_copied_props"))){var v={name:n[0].model.attributes.name,cityID:n[0].model.attributes.cityID,
rank:n[0].model.attributes.rank,segIDs:n[0].model.attributes.segIDs};r&&g(r,a.translate("edit.big_junction.errors.props_already_saved"));t&&g(t,a.translate("edit.big_junction.errors.no_changes"));k={attributes:v,turns:D,copiedJunctionId:n[0].model.attributes.id,changeableActions:[],entrances:u.map(function(z){return z.getID()}),exits:y.map(function(z){return z.getID()})}}},a.translate("edit.big_junction.copy_props"),C,m===x.Yes)[0];t=p(function(){if(null!==k){if(k.attributes.segIDs.length!==n[0].model.attributes.segIDs.length||
!k.attributes.segIDs.every(function(A){return n[0].model.attributes.segIDs.includes(A)}))for(var v={},z=e.makeIterator(k.turns),w=z.next();!w.done;v={$jscomp$loop$prop$turn$8:v.$jscomp$loop$prop$turn$8},w=z.next())v.$jscomp$loop$prop$turn$8=w.value,w=n[0].model.getPossibleTurnsBetween(v.$jscomp$loop$prop$turn$8.fromVertex,v.$jscomp$loop$prop$turn$8.toVertex).find(function(A){return function(R){return R.turnData.segmentPath.length===A.$jscomp$loop$prop$turn$8.turnData.segmentPath.length}}(v)),v.$jscomp$loop$prop$turn$8.turnData.segmentPath=
w.turnData.segmentPath;var G=require("Waze/Model/Graph/Actions/SetTurn");W.model.actionManager.add(new c(k.turns.map(function(A){return new G(W.model.turnGraph,A)}),n[0].model,{name:k.attributes.name,cityID:k.attributes.cityID,rank:k.attributes.rank}));f()}},a.translate("edit.big_junction.paste_props"),E,null!==k&&null===E)[0]}});W.model.actionManager.events.on("afteraction",l);W.model.actionManager.events.on("afterundoaction",function(){null!==k&&f()});W.model.actionManager.events.on("afterclearactions",
function(){null!==k&&(k.changeableActions=[])})};(this&&this.__awaiter||function(a,b,c,d){function g(h){return h instanceof c?h:new c(function(f){f(h)})}return new (c||(c=Promise))(function(h,f){function l(t){try{r(d.next(t))}catch(m){f(m)}}function k(t){try{r(d["throw"](t))}catch(m){f(m)}}function r(t){t.done?h(t.value):g(t.value).then(l,k)}r((d=d.apply(a,b||[])).next())})})(void 0,void 0,void 0,function S(){var b,c;return e.generator.createGenerator(S,function(d){1==d.nextAddress&&console.log("[Roundabout JB] Loading script");if(3!=d.nextAddress)return window.hasOwnProperty("require")?
d.jumpTo(3):d.yield(new Promise(function(g){return setTimeout(g,100)}),2);b=new L;c=require("Waze/Action/AddAlternateStreet").__proto__;console.log("[Roundabout JB] Script loaded | Locale: %s",b.locale);M();O(b);P(b,c);Q(b,c);d.jumpToEnd()})});}).call(this);
